{"version":3,"file":"State.js","sourceRoot":"","sources":["../src/State.ts"],"names":[],"mappings":"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","sourcesContent":["import isEqual from 'lodash/isEqual';\nimport { isModulePreloaded } from 'snack-content';\n\nimport { SnackState } from './types';\n\nexport type StateObject<T> = {\n  [key: string]: T;\n};\n\nexport function addObjects<T>(\n  state: StateObject<T>,\n  content: { [key: string]: T },\n  filter?: (a: T, b: T) => boolean,\n): StateObject<T> {\n  let newState: StateObject<T> | null = null;\n  for (const key in content) {\n    if (filter ? filter(content[key], state[key]) : !isEqual(content[key], state[key])) {\n      newState = newState ?? { ...state };\n      newState[key] = content[key];\n    }\n  }\n  return newState ?? state;\n}\n\nexport function addObject<T>(\n  state: StateObject<T>,\n  key: string,\n  content: T,\n  filter?: (a: T, b: T) => boolean,\n): StateObject<T> {\n  return addObjects(state, { [key]: content }, filter);\n}\n\nexport function removeObjects<T>(state: StateObject<T>, keys: string[]): StateObject<T> {\n  if (!keys.length) return state;\n  let newState: StateObject<T> | null = null;\n  keys.forEach((key) => {\n    if (state[key]) {\n      newState = newState ?? { ...state };\n      delete newState[key];\n    }\n  });\n  return newState ?? state;\n}\n\nexport function removeObject<T>(state: StateObject<T>, key: string): StateObject<T> {\n  return removeObjects(state, [key]);\n}\n\nexport function updateObjects<T>(\n  state: StateObject<T>,\n  content: { [key: string]: T | null },\n  compareFn: (a: T, b: T) => boolean = isEqual,\n): StateObject<T> {\n  let newState: StateObject<T> | null = null;\n  for (const key in content) {\n    const val = content[key];\n    if (val === null) {\n      if (state[key]) {\n        newState = newState ?? { ...state };\n        delete newState[key];\n      }\n    } else if (!compareFn(val, state[key])) {\n      newState = newState ?? { ...state };\n      newState[key] = val;\n    }\n  }\n  return newState ?? state;\n}\n\nexport function isBusy(state: SnackState): boolean {\n  return (\n    !!Object.keys(state.dependencies).find(\n      (name) => !state.dependencies[name].handle && !isModulePreloaded(name, state.sdkVersion),\n    ) ||\n    !!Object.values(state.files).find(\n      (file) => file.type === 'ASSET' && typeof file.contents !== 'string',\n    )\n  );\n}\n\nexport function isCodeChanged(state: SnackState, prevState: SnackState) {\n  return (\n    state.dependencies !== prevState.dependencies ||\n    state.files !== prevState.files ||\n    state.sdkVersion !== prevState.sdkVersion\n  );\n}\n\nexport function isUnsaved(state: SnackState, prevState: SnackState) {\n  return (\n    state.dependencies !== prevState.dependencies ||\n    state.files !== prevState.files ||\n    state.sdkVersion !== prevState.sdkVersion ||\n    state.name !== prevState.name ||\n    state.description !== prevState.description\n  );\n}\n"]}